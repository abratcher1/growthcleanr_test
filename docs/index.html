<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Growth Measurements Cleaner • growthcleanr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Growth Measurements Cleaner">
<meta property="og:description" content="growthcleanr cleans growth data that may contain implausible data based on unit or data range.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">growthcleanr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="growthcleanr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#growthcleanr" class="anchor"></a>growthcleanr</h1></div>
<!-- badges: start -->

<!-- badges: end -->
<p>R package for cleaning data from Electronic Health Record systems, focused on cleaning height and weight measurements.</p>
<p><a name="cite"></a> This package implements the <a href="https://academic.oup.com/jamia/article/24/6/1080/3767271">Daymont et al. algorithm</a>, as specified in Supplemental File 3 within the <a href="https://academic.oup.com/jamia/article/24/6/1080/3767271#97610899">Supplementary Material</a> published with that paper.</p>
<blockquote>
<p>Carrie Daymont, Michelle E Ross, A Russell Localio, Alexander G Fiks, Richard C Wasserman, Robert W Grundmeier, Automated identification of implausible values in growth data from pediatric electronic health records, Journal of the American Medical Informatics Association, Volume 24, Issue 6, November 2017, Pages 1080–1087, <a href="https://doi.org/10.1093/jamia/ocx037" class="uri">https://doi.org/10.1093/jamia/ocx037</a></p>
</blockquote>
<p>This package also includes an R version of the <a href="https://www.cdc.gov/nccdphp/dnpao/growthcharts/resources/sas.htm">SAS macro published by the CDC</a> for calculating percentiles and Z-scores of pediatric growth observations and utilities for working with both functions. As of spring 2021, it also supports cleaning anthropometric measurements for adults up to age 65.</p>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>The <code>growthcleanr</code> package processes data prepared in a specific format to identify biologically implausible height and weight measurements. It bases these evaluations on techniques which use patient-specific longitudinal analysis and variations from published growth trajectory charts for pediatric subjects. These techniques are performed in a specific order which refines and improves results throughout the process.</p>
<p>Results from <code>growthcleanr</code> include a flag for each measurement indicating whether it is to be included or excluded based on plausibility, with a variety of specific types of exclusions identified distinctly. These flags can be analyzed further by researchers studying anthropometric EHR data to determine which measurements to include or exclude in their own studies. No values are deleted or otherwise removed; each is only flagged in a new column.</p>
<p>To start running <code>growthcleanr</code>, an R installation with a variety of additional packages is required, as is a growth measurement dataset prepared for use in <code>growthcleanr</code>.</p>
<p>The rest of this documentation includes:</p>
<ul>
<li>
<a href="#quickstart">Quickstart</a> - a brief tour of using growthcleanr, including data preparation</li>
<li>
<a href="#installation">Installation</a> - including required dependencies and OS-specific notes</li>
<li>
<a href="#usage">Usage</a> - examples of cleaning data, multiple options, example data</li>
<li>
<a href="#configuration">Configuration options</a> - changing growthcleanr operational settings</li>
<li>
<a href="#output">Understanding output</a> - the exclusion types growthcleanr identifies</li>
<li>
<a href="#largedata">Working with large datasets</a> - notes and suggestions</li>
<li>
<a href="#bmi">Computing BMI percentiles and Z-scores</a> - additional functions for determining percentiles and Z-scores using the CDC method</li>
<li>
<a href="#related">Related tools</a> - additional software complementary to growthcleanr</li>
<li>
<a href="#changes">Changes</a> - notes about algorithm or package changes</li>
</ul>
</div>
<div id="quickstart" class="section level2">
<h2 class="hasAnchor">
<a href="#quickstart" class="anchor"></a><a name="quickstart"></a>Quickstart</h2>
<div id="r-setup" class="section level3">
<h3 class="hasAnchor">
<a href="#r-setup" class="anchor"></a><a name="setup"></a>R setup</h3>
<p>The <code>growthcleanr</code> package must be installed, which will in turn install the following packages:</p>
<ul>
<li><code>data.table</code></li>
<li><code>foreach</code></li>
<li><code>doParallel</code></li>
<li><code>parallel</code></li>
<li><code>dplyr</code></li>
<li><code>labelled</code></li>
<li><code>plyr</code></li>
<li><code>tidyr</code></li>
<li><code>magrittr</code></li>
</ul>
<p>In addition, an R environment with <code>devtools</code> installed is also required. Further installation details and notes can be found under <a href="#installation">Installation</a> below.</p>
</div>
<div id="data-preparation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h3>
<p>Once the <code>growthcleanr</code> package and its dependencies are installed, the minimal data vectors needed are:</p>
<ol>
<li>
<code>subjid</code> - a unique identifier for each subject; if you have long (64-bit) integer <code>subjid</code> values, add the <code>bit64</code> R package to your install list to ensure R will process these correctly</li>
<li>
<code>param</code> - a string designating the measurement being ‘<code>HEIGHTCM</code>’, ‘<code>LENGTHCM</code>’, or ‘<code>WEIGHTKG</code>’</li>
<li>
<code>agedays</code> - a numeric value for age in days at time of measurement; will be rounded down (floor) to nearest integer if needed (note that there are 30.4375 days in one month; see also the additional <a href="https://www.cdc.gov/nccdphp/dnpao/growthcharts/resources/sas.htm">notes on calculating <code>agemos</code></a> from whole numbers of months</li>
<li>
<code>sex</code> - a numeric value of <code>0</code> (male) or <code>1</code> (female)</li>
<li>
<code>measurement</code> - numeric value of measurement in cm for height or kg for weight</li>
</ol>
<p><strong>Note</strong>: the dataset should be sorted by <code>subjid</code>, <code>param</code>, and <code>agedays</code>, as demonstrated in the Example below.</p>
</div>
<div id="example" class="section level3">
<h3 class="hasAnchor">
<a href="#example" class="anchor"></a><a name="example"></a>Example</h3>
<p>Starting with a dataset such as the following:</p>
<table class="table">
<thead><tr class="header">
<th>subjid</th>
<th>param</th>
<th>agedays</th>
<th>sex</th>
<th>measurement</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>HEIGHTCM</td>
<td>2790</td>
<td>0</td>
<td>118.5</td>
</tr>
<tr class="even">
<td>1</td>
<td>HEIGHTCM</td>
<td>3677</td>
<td>0</td>
<td>148.22</td>
</tr>
<tr class="odd">
<td>1</td>
<td>WEIGHTKG</td>
<td>2790</td>
<td>0</td>
<td>23.8</td>
</tr>
<tr class="even">
<td>1</td>
<td>WEIGHTKG</td>
<td>3677</td>
<td>0</td>
<td>38.41</td>
</tr>
<tr class="odd">
<td>2</td>
<td>HEIGHTCM</td>
<td>2112</td>
<td>1</td>
<td>118.2</td>
</tr>
<tr class="even">
<td>2</td>
<td>HEIGHTCM</td>
<td>2410</td>
<td>1</td>
<td>123.9</td>
</tr>
<tr class="odd">
<td>2</td>
<td>HEIGHTCM</td>
<td>2708</td>
<td>1</td>
<td>128.03</td>
</tr>
<tr class="even">
<td>2</td>
<td>HEIGHTCM</td>
<td>3029</td>
<td>1</td>
<td>135.3</td>
</tr>
<tr class="odd">
<td>2</td>
<td>WEIGHTKG</td>
<td>2112</td>
<td>1</td>
<td>25.84</td>
</tr>
<tr class="even">
<td>2</td>
<td>WEIGHTKG</td>
<td>2410</td>
<td>1</td>
<td>28.61</td>
</tr>
<tr class="odd">
<td>2</td>
<td>WEIGHTKG</td>
<td>2708</td>
<td>1</td>
<td>28.61</td>
</tr>
<tr class="even">
<td>2</td>
<td>WEIGHTKG</td>
<td>3029</td>
<td>1</td>
<td>34.5</td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Note that in this Example, we see data from two subjects, sorted as described above, with two pairs of height/weight measurements for the first patient and four pairs for the second. Most of these values pass the “eyeball test”, but the third weight measurement for <code>subjid</code> 2 looks like it might be a carried forward value, given that their same ageday height has changed by several centimeters and their third height value is exactly the same as their second. This is an example of an implausible value and exclusion type that <code>growthcleanr</code> might identify.</p>
<p>The <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> function provided by <code>growthcleanr</code> will return a vector that specifies, for each measurement, whether to:</p>
<ul>
<li>“<code>Include</code>” the measurement,</li>
<li>Conclude that the measurement is “<code>Missing</code>”,</li>
<li>Or to “<code>Exclude</code>” the measurement (numerous variations of <code>Exclude</code> exist, as specified below in Understanding output).</li>
</ul>
<p>For a data.frame object <code>source_data</code> containing growth data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">growthcleanr</span><span class="op">)</span>

<span class="co"># prepare data as a data.table</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">as.data.table</span><span class="op">(</span><span class="va">source_data</span><span class="op">)</span>

<span class="co"># set the data.table key for better indexing</span>
<span class="fu">setkey</span><span class="op">(</span><span class="va">data</span>, <span class="va">subjid</span>, <span class="va">param</span>, <span class="va">agedays</span><span class="op">)</span>

<span class="co"># generate new exclusion flag field using function</span>
<span class="va">cleaned_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="va">gcr_result</span> <span class="op">:=</span> <span class="fu"><a href="reference/cleangrowth.html">cleangrowth</a></span><span class="op">(</span><span class="va">subjid</span>, <span class="va">param</span>, <span class="va">agedays</span>, <span class="va">sex</span>, <span class="va">measurement</span><span class="op">)</span><span class="op">]</span>

<span class="co"># extract data limited only to values flagged for inclusion:</span>
<span class="va">only_included_data</span> <span class="op">&lt;-</span> <span class="va">cleaned_data</span><span class="op">[</span><span class="va">gcr_result</span> <span class="op">==</span> <span class="st">"Include"</span><span class="op">]</span></code></pre></div>
<p>If our Example dataset above were named <code>source_data</code>, examining <code>cleaned_data</code> would show:</p>
<table class="table">
<thead><tr class="header">
<th>subjid</th>
<th>param</th>
<th>agedays</th>
<th>sex</th>
<th>measurement</th>
<th>gcr_result</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>HEIGHTCM</td>
<td>2790</td>
<td>0</td>
<td>118.5</td>
<td>Include</td>
</tr>
<tr class="even">
<td>1</td>
<td>HEIGHTCM</td>
<td>3677</td>
<td>0</td>
<td>148.22</td>
<td>Include</td>
</tr>
<tr class="odd">
<td>1</td>
<td>WEIGHTKG</td>
<td>2790</td>
<td>0</td>
<td>23.8</td>
<td>Include</td>
</tr>
<tr class="even">
<td>1</td>
<td>WEIGHTKG</td>
<td>3677</td>
<td>0</td>
<td>38.41</td>
<td>Include</td>
</tr>
<tr class="odd">
<td>2</td>
<td>HEIGHTCM</td>
<td>2112</td>
<td>1</td>
<td>118.2</td>
<td>Include</td>
</tr>
<tr class="even">
<td>2</td>
<td>HEIGHTCM</td>
<td>2410</td>
<td>1</td>
<td>123.9</td>
<td>Include</td>
</tr>
<tr class="odd">
<td>2</td>
<td>HEIGHTCM</td>
<td>2708</td>
<td>1</td>
<td>128.03</td>
<td>Include</td>
</tr>
<tr class="even">
<td>2</td>
<td>HEIGHTCM</td>
<td>3029</td>
<td>1</td>
<td>135.3</td>
<td>Include</td>
</tr>
<tr class="odd">
<td>2</td>
<td>WEIGHTKG</td>
<td>2112</td>
<td>1</td>
<td>25.84</td>
<td>Include</td>
</tr>
<tr class="even">
<td>2</td>
<td>WEIGHTKG</td>
<td>2410</td>
<td>1</td>
<td>28.61</td>
<td>Include</td>
</tr>
<tr class="odd">
<td>2</td>
<td>WEIGHTKG</td>
<td>2708</td>
<td>1</td>
<td>28.61</td>
<td>Exclude-Carried-Forward</td>
</tr>
<tr class="even">
<td>2</td>
<td>WEIGHTKG</td>
<td>3029</td>
<td>1</td>
<td>34.5</td>
<td>Include</td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>In this sample output, we see that <code>growthcleanr</code> has indeed flagged the third weight measurement for <code>subjid 2</code> as an apparent carried forward value. The measurement remains in the dataset, and it is up to the researcher to determine which exclusions to accept directly or investigate further.</p>
<p>To compute percentiles and Z-scores using the included CDC macro, continue with these next steps:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use the built-in utility function to convert the input observations to wide</span>
<span class="co"># format for BMI calculation</span>
<span class="va">cleaned_data_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/longwide.html">longwide</a></span><span class="op">(</span><span class="va">cleaned_data</span><span class="op">)</span>

<span class="co"># Compute simple BMI</span>
<span class="va">cleaned_data_bmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simple_bmi.html">simple_bmi</a></span><span class="op">(</span><span class="va">cleaned_data_wide</span><span class="op">)</span>

<span class="co"># Compute Z-scores and percentiles</span>
<span class="va">cleaned_data_bmiz</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ext_bmiz.html">ext_bmiz</a></span><span class="op">(</span><span class="va">cleaned_data_bmi</span><span class="op">)</span></code></pre></div>
<p>The <code><a href="reference/longwide.html">longwide()</a></code> function defaults to converting only records included by <code><a href="reference/cleangrowth.html">cleangrowth()</a></code>, with options to change this default, and <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code> will return the wide version of the cleaned data with many metrics added. Both of these functions are <a href="#bmi">described in detail below</a>.</p>
</div>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a><a name="installation"></a>Installation</h2>
<p>`growthcleanr has been developed and tested using R version 3 (most recently 3.6+). It should work using R on Windows, macOS, or Unix/Linux, although there are some additional <a href="#platform">platform-specific notes</a> you may wish to review.</p>
<p>In an up-to-date R environment such as RStudio, first install the dependencies:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Required packages for growthcleanr operation</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="co"># Optional additional packages referenced in this document</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"argparser"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"bit64"</span><span class="op">)</span></code></pre></div>
<p>Note that this might take some time.</p>
<p>You can install the <code>growthcleanr</code> package directly from GitHub using <code>devtools</code> in the R console with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"carriedaymont/growthcleanr"</span>, ref<span class="op">=</span><span class="st">"main"</span><span class="op">)</span></code></pre></div>
<p>Note that <code>ref="main"</code> is required; the default branch is “main”, and must be referred to explicitly.</p>
<p>If you are unable to install <code>devtools</code>, a similar function is available in the <code>remotes</code> package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"carriedaymont/growthcleanr"</span>, ref<span class="op">=</span><span class="st">"main"</span><span class="op">)</span></code></pre></div>
<p>Note that <code>ref="main"</code> is required; the default branch is “main”, and must be referred to explicitly.</p>
<div id="source-level-install-for-developers" class="section level3">
<h3 class="hasAnchor">
<a href="#source-level-install-for-developers" class="anchor"></a>Source-level install for developers</h3>
<p>If you want to work with and potentially change the <code>growthcleanr</code> code itself, you can download or clone the <code>growthcleanr</code> source code and then install it from source. To clone the source using <code>git</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">%</span> git clone https://github.com/carriedaymont/growthcleanr.git</span></code></pre></div>
<p>Either way, once you have the <code>growthcleanr</code> package source, open an R session from the <code>growthcleanr</code> base directory. Then install growthcleanr using the R <code>devtools</code> package:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/install.html">install</a></span><span class="op">(</span><span class="st">"."</span><span class="op">)</span></code></pre></div>
<p>You can also install the package from an installation file if one is obtained.</p>
</div>
<div id="platform-specific-notes" class="section level3">
<h3 class="hasAnchor">
<a href="#platform-specific-notes" class="anchor"></a><a name="platform"></a>Platform-specific notes</h3>
<div id="windows" class="section level4">
<h4 class="hasAnchor">
<a href="#windows" class="anchor"></a>Windows</h4>
<p>We have observed an issue with using <code>growthcleanr</code> with Windows in a large agency where some R packages are installed by an administrator for a user who may not have write access permissions on the package folder. Similar issues may occur with some networked drives. This caused problems with <code>growthcleanr</code>’s parallel processing option. If possible, install R and its packages in locations hosted on the same local machine and folder(s) for which the primary user has write permissions. These steps should help to avoid this problem.</p>
<p>Some users have reported that <code>growthcleanr</code> runs more slowly on Windows compared with Linux or macOS.</p>
</div>
<div id="macos" class="section level4">
<h4 class="hasAnchor">
<a href="#macos" class="anchor"></a>macOS</h4>
<p><code>growthcleanr</code> uses the <a href="https://rdatatable.gitlab.io/data.table/"><code>data.table</code></a> package for R extensively. <code>data.table</code> provides a faster version of R’s data frames, and is used to improve <code>growthcleanr</code> performance. Typically <code>data.table</code> installs in a manner that will be able to take advantage of multiple threads. You will know it worked successfully if, when you load the <code>data.table</code> library in R, you see something like the following:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>data.table <span class="dv">1</span>.<span class="fl">12.2</span> using <span class="dv">2</span> <span class="fu">threads</span> (see ?getDTthreads).  Latest news<span class="sc">:</span> r<span class="sc">-</span>datatable.com</span></code></pre></div>
<p>That data.table reports “using 2 threads” indicates that installation has succeeded. If the message reports using only one thread, see the advice under the <a href="https://github.com/Rdatatable/data.table/wiki/Installation#openmp-enabled-compiler-for-mac">“OpenMP enabled compiler for Mac” instructions</a> to re-install <code>data.table</code>.</p>
<p>Users have reported errors running multiple batches with <code>parallel = T</code> from within RStudio. If this happens, the problem may be resolved by running from RGui or from the command line using <code>Rscript</code>. An example standalone script that may be used for this purpose is documented below under <a href="#largedata">Working with large data sets</a>.</p>
</div>
<div id="docker" class="section level4">
<h4 class="hasAnchor">
<a href="#docker" class="anchor"></a>Docker</h4>
<p>This package includes a <code>Dockerfile</code> that enables easy installation of R and <code>growthcleanr</code> on a machine with <a href="https://www.docker.com/">Docker</a> installed. It requires an up-to-date Docker install, and a few command-line steps, but can save time over installing R and <code>growthcleanr</code>’s dependencies manually.</p>
<p>To install and run <code>growthcleanr</code> using Docker, open the PowerShell on Windows, or open the Terminal on macOS, and enter this <code>docker</code> command:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">%</span> docker run <span class="at">-it</span> mitre/growthcleanr:latest R</span></code></pre></div>
<p>The first time this command is run, it might take a few minutes to download and extract several necessary components, but this should be fully automated. If successful, you should see an R prompt, from which you can use <code>growthcleanr</code> as described below.</p>
<p>This R environment is virtualized inside Docker, however, and isolated from your local machine. Because of this, you will need to map a local folder on your computer into the Docker environment to work with your own data. For example, if you are on Windows, and your data is in <code>C:\Users\exampleuser\analysis</code>, specify a mapping using the added <code>-v</code> step below:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">%</span> docker run <span class="at">-it</span> <span class="at">-v</span> C:\Users\exampleusers\analysis:/usr/src/app mitre/growthcleanr:latest R</span></code></pre></div>
<p>Note that the slashes in file paths reverse direction from the reference to the folder location on your Windows machine (before the colon) to the folder location on the Docker container (after the colon); this is intentional, and accounts for how the two different environments reference disk locations.</p>
<p>Note also that when mapping a folder on Windows, you may be prompted to confirm that you indeed want to “Share” the folder. This is a standard Windows security practice, and it is okay to confirm and proceed.</p>
<p>If you are on macOS, and your data is in <code>/Users/exampleuser/analysis</code>, specify a folder mapping like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">%</span> docker run <span class="at">-it</span> <span class="at">-v</span> /Users/exampleuser/analysis:/usr/src/app mitre/growthcleanr:latest R</span></code></pre></div>
<p>If you mapped a folder, then inside the Docker environment’s R prompt, when you then issue a command like <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code>, you should see a list of the same files in the R session that you see in that folder on your desktop. You can now open and read your data files, run <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> and other analyses, and write result files to that same directory.</p>
<p>Exit the Docker R environment with <code><a href="https://rdrr.io/r/base/quit.html">quit()</a></code> as you normally would. Any new files you saved will appear in the desktop folder you mapped.</p>
</div>
</div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a><a name="usage"></a>Usage</h2>
<p>With the <code>growthcleanr</code> package installed <a href="#installation">as described above</a>, it can be loaded as a package:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">growthcleanr</span><span class="op">)</span></code></pre></div>
<p>For convenience, <code>growthcleanr</code> ships with an example synthetic dataset created using <a href="https://synthetichealth.github.io/synthea/">Synthea</a>, with support for simulated pediatric growth measurement errors based on the protocol included as supplementary material to the <a href="#cite">Daymont et al. paper</a>. This dataset is automatically loaded with the <code>growthcleanr</code> library, and is called <code>syngrowth</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">syngrowth</span><span class="op">)</span>
<span class="co">#&gt; [1] 85728     6</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">syngrowth</span><span class="op">)</span>
<span class="co">#&gt;   id     subjid sex agedays    param measurement</span>
<span class="co">#&gt; 1  1 1575544570   1    2177 HEIGHTCM      104.40</span>
<span class="co">#&gt; 2  2 1575544570   1    2548 HEIGHTCM      117.70</span>
<span class="co">#&gt; 3  3 1575544570   1    2548 HEIGHTCM      117.74</span>
<span class="co">#&gt; 4  4 1575544570   1    2919 HEIGHTCM      117.70</span>
<span class="co">#&gt; 5  5 1575544570   1    3290 HEIGHTCM      129.20</span>
<span class="co">#&gt; 6  6 1575544570   1    3661 HEIGHTCM      133.90</span></code></pre></div>
<p>It can be used as in the example above. Note that processing the example data with <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> will likely take a few minutes to complete.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(syngrowth)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(data, subjid, param, agedays)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="ot">&lt;-</span> data[, gcr_result <span class="sc">:</span><span class="er">=</span> <span class="fu">cleangrowth</span>(subjid, param, agedays, sex, measurement)]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cleaned_data)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>      id                               subjid sex  agedays    param measurement                  gcr_result</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="dv">83330</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28   <span class="dv">1</span> <span class="fl">20489.22</span> HEIGHTCM       <span class="fl">151.1</span>                     Include</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="dv">83332</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28   <span class="dv">1</span> <span class="fl">20860.22</span> HEIGHTCM       <span class="fl">151.1</span>                     Include</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="dv">83334</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28   <span class="dv">1</span> <span class="fl">20860.22</span> HEIGHTCM       <span class="fl">150.6</span> Exclude<span class="sc">-</span>Same<span class="sc">-</span>Day<span class="sc">-</span>Extraneous</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="dv">83335</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28   <span class="dv">1</span> <span class="fl">21231.22</span> HEIGHTCM       <span class="fl">151.1</span>                     Include</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> <span class="dv">83337</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28   <span class="dv">1</span> <span class="fl">21602.22</span> HEIGHTCM       <span class="fl">151.1</span>                     Include</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="dv">83339</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28   <span class="dv">1</span> <span class="fl">21623.22</span> HEIGHTCM       <span class="fl">151.1</span>                     Include</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(gcr_result) <span class="sc">%&gt;%</span> <span class="fu">tally</span>(<span class="at">sort=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 26 x 2</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>   gcr_result                      n</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>fct<span class="sc">&gt;</span>                       <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> Include                     <span class="dv">61652</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> Exclude<span class="sc">-</span>Extraneous<span class="sc">-</span>Same<span class="sc">-</span>Day <span class="dv">11263</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> Exclude<span class="sc">-</span>Carried<span class="sc">-</span>Forward      <span class="dv">7093</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> Exclude<span class="sc">-</span>Same<span class="sc">-</span>Day<span class="sc">-</span>Extraneous  <span class="dv">4010</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> Exclude<span class="sc">-</span>Same<span class="sc">-</span>Day<span class="sc">-</span>Identical    <span class="dv">623</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> Exclude<span class="sc">-</span>SD<span class="sc">-</span>Cutoff             <span class="dv">175</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> Exclude<span class="sc">-</span>EWMA<span class="dv">-8</span>                <span class="dv">139</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> Exclude<span class="sc">-</span>Distinct<span class="dv">-3</span><span class="sc">-</span>Or<span class="sc">-</span>More    <span class="dv">125</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> Exclude<span class="sc">-</span>BIV                   <span class="dv">108</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> Exclude<span class="sc">-</span>EWMA<span class="sc">-</span>Extreme           <span class="dv">99</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co"># … with 16 more rows</span></span></code></pre></div>
<p>If you are able to run these steps and see a similar result, you have the <code>growthcleanr</code> package installed correctly. The resulting <code>cleaned_data</code> can be reviewed, subsetted, and compared in more detail using all the tools R provides.</p>
<p>For complete information about the options that can be set on the <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> function, see <a href="#configuration">Configuration</a>. Below are a few additional examples:</p>
<p>This example shows three configuration options in use:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cleaned_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>,
  <span class="va">gcr_result_both</span> <span class="op">:=</span> <span class="fu"><a href="reference/cleangrowth.html">cleangrowth</a></span><span class="op">(</span>
    <span class="va">subjid</span>, <span class="va">param</span>, <span class="va">agedays</span>, <span class="va">sex</span>, <span class="va">measurement</span>,
    lt3.exclude.mode <span class="op">=</span> <span class="st">"flag.both"</span>,
    ref.data.path <span class="op">=</span> <span class="st">"inst/extdata/"</span>,
    quietly <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span>
<span class="op">]</span></code></pre></div>
<ul>
<li><p><code>lt3.exclude.mode = "flag.both"</code> will exclude both measurements for a subject if they only have two unexcluded measurements of one parameter type with at least one implausible value and no same age-day measurements of the other parameter.</p></li>
<li><p><code>ref.data.path = "inst/extdata"</code> shouldn’t be necessary if you have the <code>growthcleanr</code> package installed, but if you are running it from its source directly you may need to specify its full path.</p></li>
<li><p><code>quietly = F</code> enables verbose output, marking the progress of the algorithm through its many processing steps. This can be very helpful while testing.</p></li>
</ul>
<p>This example shows built-in options for processing data in batches, which can speed the process while working with large data sets:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cleaned_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>,
  <span class="va">gcr_result_both</span> <span class="op">:=</span> <span class="fu"><a href="reference/cleangrowth.html">cleangrowth</a></span><span class="op">(</span>
    <span class="va">subjid</span>, <span class="va">param</span>, <span class="va">agedays</span>, <span class="va">sex</span>, <span class="va">measurement</span>,
    parallel <span class="op">=</span> <span class="cn">TRUE</span>,
    num.batches <span class="op">=</span> <span class="fl">4</span>,
    log.path <span class="op">=</span> <span class="st">"logs"</span>
  <span class="op">)</span>
<span class="op">]</span></code></pre></div>
<p>The best <code>num.batches</code> value for your environment may vary depending on the computing resources you have available. If you do not specify <code>num.batches</code>, <code>growthcleanr</code> will estimate a batch count based on R functions for checking the system hardware. If you are working with large datasets, you may need to experiment with these options to determine the best settings for your needs. Note that there are additional notes on <a href="#largedata">working with large datasets</a> below.</p>
<p>The default value of <code>log.path</code> is <code>"."</code>, the current working directory. <code>growthcleanr</code> will write batch-specific log files to the <code>log.path</code> directory, and will create the directory if necessary.</p>
<p>Note that if you run <code>growthcleanr</code> in parallel with multiple batches and see warning errors such as the following, they can be ignored.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Warning messages<span class="sc">:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="er">&lt;</span>anonymous<span class="sc">&gt;</span><span class="er">:</span> ... may be used <span class="cf">in</span> an incorrect context<span class="sc">:</span> ‘<span class="fu">.fun</span>(piece, ...)’</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="er">&lt;</span>anonymous<span class="sc">&gt;</span><span class="er">:</span> ... may be used <span class="cf">in</span> an incorrect context<span class="sc">:</span> ‘<span class="fu">.fun</span>(piece, ...)’</span></code></pre></div>
<p>This set of warnings is coming from one of <code>growthcleanr</code>’s dependencies, and does not indicate either failure or improper execution.</p>
</div>
<div id="configuration-options" class="section level2">
<h2 class="hasAnchor">
<a href="#configuration-options" class="anchor"></a><a name="configuration"></a>Configuration options</h2>
<p><code>growthcleanr</code> offers several options for configuration, with default values set to address common cases. You may wish to experiment with the settings to discover which work best for your research and your dataset.</p>
<p>All of the following options may be set as additional parameters in the call to <code><a href="reference/cleangrowth.html">cleangrowth()</a></code>.</p>
<div id="algorithm-related-options" class="section level3">
<h3 class="hasAnchor">
<a href="#algorithm-related-options" class="anchor"></a>Algorithm-related options</h3>
<p>The following options change the behavior of the growthcleanr algorithm.</p>
<ul>
<li><p><code>recover.unit.error</code> - default <code>FALSE</code>; when <code>FALSE</code>, measurements identified as unit errors (e.g., apparent height values in inches instead of centimeters) will be flagged but not corrected, when <code>TRUE</code> these values will be corrected and included as valid measurements for cleaning.</p></li>
<li><p><code>sd.extreme</code> - default <code>25</code>; a very extreme value check on modified (recentered) Z-scores used as a first-pass elimination of clearly implausible values, often due to misplaced decimals.</p></li>
<li><p><code>z.extreme</code> - default <code>25</code>; similar usage as <code>sd.extreme</code>, for absolute Z-scores.</p></li>
</ul>
<p><strong>NOTE</strong>: many different steps in the <code>growthcleanr</code> algorithm use highly refined techniques to identify implausible values that require more subtlety to detect. These default values for <code>sd.extreme</code> and <code>z.extreme</code> are set very high by design to eliminate completely implausible values early in the process; these extreme values require none of <code>growthcleanr</code>’s additional, more subtle approaches to be identified as exclusions. If <code>sd.extreme</code> and <code>z.extreme</code> are configured to be lower values, measurements eliminated at the early step which checks against these extreme values will not be further considered using later techniques.</p>
<ul>
<li><p><code>include.carryforward</code> - default <code>FALSE</code>; if set to <code>TRUE</code>, <code>growthcleanr</code> will skip algorithm step 9, which identifies carried forward measurements, and will not flag these values for exclusion.</p></li>
<li><p><code>ewma.exp</code> - default <code>-1.5</code>; the exponent used for weighting measurements when calculating exponentially weighted moving average (EWMA). This exponent should be negative to weight growth measurements closer to the measurement being evaluated more strongly. Exponents that are further from zero (e.g., <code>-3</code>) will increase the relative influence of measurements close in time to the measurement being evaluated compared to using the default exponent.</p></li>
<li><p><code>ref.data.path</code> - defaults to using CDC reference data from year 2000; supply a file path to use alternate reference data. Note that when running from an installed <code>growthcleanr</code> package (e.g. having called <code><a href="https://rdrr.io/r/base/library.html">library(growthcleanr)</a></code>), this path does not need to be specified. Developers testing the source code directly from the source directory will need to specify this as well.</p></li>
<li><p><code>error.load.mincount</code> - default <code>2</code>; minimum count of exclusions on parameter for one subject before considering excluding all measurements.</p></li>
<li><p><code>error.load.threshold</code> - default <code>0.5</code>; threshold to exceed for percentage of excluded measurement count relative to count of included other measurement (e.g., if 3 of 5 WTs are excluded, and 5 corresponding HTs are included, this exceeds the 0.5 threshold and the other two WTs will be excluded).</p></li>
<li>
<p><code>lt3.exclude.mode</code> - default <code>default</code>; determines type of exclusion procedure to use for 1 or 2 measurements of one type without matching same ageday measurements for the other parameter. Options include:</p>
<ul>
<li>
<code>default</code> - standard growthcleanr approach</li>
<li>
<code>flag.both</code> - in case of two measurements with at least one beyond thresholds, flag both instead of one (as in default)</li>
</ul>
</li>
<li>
<p><code>sd.recenter</code> - default <code>NA</code>; specifies how to recenter medians. May be a data frame or table w/median SD-scores per day of life by gender and parameter, or “<code>nhanes</code>” or “<code>derive</code>” as a character vector.</p>
<ul>
<li>If <code>sd.recenter</code> is specified as a data set, use the data set</li>
<li>If <code>sd.recenter</code> is specified as “<code>nhanes</code>”, use NHANES reference medians</li>
<li>If <code>sd.recenter</code> is specified as “<code>derive</code>”, derive from input</li>
<li>If <code>sd.recenter</code> is not specified or <code>NA</code>:
<ul>
<li>If the input set has at least 5,000 observations, derive medians from input</li>
<li>If the input set has fewer than 5,000 observations, use NHANES</li>
</ul>
</li>
</ul>
<p>If specifying a data set, columns must include param, sex, agedays, and sd.median (referred to elsewhere as “modified Z-score”), and those medians will be used for centering. This data set must include a row for every ageday present in the dataset to be cleaned; the NHANES reference medians include a row for every ageday in the range (731-7305 days). A summary of how the NHANES reference medians were derived is below under <a href="#nhanes">NHANES reference data</a>.</p>
</li>
<li><p><code>adult_cutpoint</code> - default <code>20</code>; number between 18 and 20, describing ages when the pediatric algorithm should not be applied (&lt; adult_cutpoint), and the adult algorithm should apply (&gt;= adult_cutpoint). Numbers outside this range will be changed to the closest number within the range.</p></li>
<li><p><code>weight_cap</code> - default <code>Inf</code>; weight_cap Positive number, describing a weight cap in kg (rounded to the nearest .1, +/- .1) within the adult dataset. If there is no weight cap, set to Inf.</p></li>
<li><p><code>adult_columns_filename</code> - default <code>""</code>; Name of file to save original adult data, with additional output columns to as CSV. Defaults to ““, for which this data will not be saved. Useful for post-analysis. For more information on this output, please see README.</p></li>
</ul>
</div>
<div id="operational-options" class="section level3">
<h3 class="hasAnchor">
<a href="#operational-options" class="anchor"></a>Operational options</h3>
<p>The following options change the execution of the program overall, with no effect on the algorithm itself.</p>
<ul>
<li><p><code>parallel</code> - default <code>FALSE</code>; set to <code>TRUE</code> to run <code>growthcleanr</code> in parallel. Running in parallel will split the input data into batches (while keeping all records for each subject together) and process each batch on a different processor/core to maximize throughput. Recommended for large datasets with more than 100K rows.</p></li>
<li><p><code>num.batches</code> - specifies the number of batches to run in parallel; only applies if <code>parallel</code> is set to <code>TRUE</code>. Defaults to the number of workers returned by the <code>getDoParWorkers()</code> function in the <code>foreach</code> package. Note that processing in parallel may affect overall system performance.</p></li>
<li><p><code>sdmedian.filename</code> - filename for optionally saving sd.median data calculated on the input dataset to as CSV. Defaults to <code>""</code>, for which this data will not be saved. Use for extracting medians for parallel processing scenarios other than the built-in parallel option. See notes on <a href="#largedata">large data sets</a> for details.</p></li>
<li><p><code>sdrecentered.filename</code> - filename to save re-centered data to as CSV. Defaults to ““, for which this data will not be saved. Useful for post-processing and debugging.</p></li>
<li><p><code>quietly</code> - default <code>TRUE</code>; when <code>TRUE</code>, displays function messages and will output log files when <code>parallel</code> is <code>TRUE</code>.</p></li>
<li><p><code>log.path</code> - default <code>"."</code>; sets directory for batch log file output when processing with <code>parallel = TRUE</code>. A new directory will be created if necessary.</p></li>
</ul>
</div>
</div>
<div id="understanding-output" class="section level2">
<h2 class="hasAnchor">
<a href="#understanding-output" class="anchor"></a><a name="output"></a>Understanding output</h2>
<p>As seen <a href="#example">in the example above</a>, <code>growthcleanr</code> creates a vector of flags identifying which measurements should be included or excluded, and why. This vector can be added to the original dataset for further review. The flags <code>growthcleanr</code> sets are text labels, most of which are descriptive. The text does not always map directly back to the precise step in the algorithm.</p>
<p>For convenience, the following table maps which <code>algorithm step</code> in the pediatric algorithm, as defined by Supplemental File 3 within the <a href="https://academic.oup.com/jamia/article/24/6/1080/3767271#97610899">Supplementary Material</a> of the Daymont et al. paper, define exclusions in the algorithm by the exclusion identifier also prescribed in the algorithm (“<code>algorithm exc id</code>”). The <code>exclusion type</code> column identifies the text of the exclusion flag set by <code>growthcleanr</code>. The <code>notes</code> column at right identifies minor discrepancies between the algorithm’s step labels and labels used in comment text in <code>growthcleanr</code>.</p>
<table class="table">
<thead><tr class="header">
<th>algorithm step</th>
<th>algorithm exc id</th>
<th>exclusion type</th>
<th>notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>2d</td>
<td>0</td>
<td>Include</td>
<td>-</td>
</tr>
<tr class="even">
<td>2d</td>
<td>1</td>
<td>Missing</td>
<td>-</td>
</tr>
<tr class="odd">
<td>5b</td>
<td>2</td>
<td>Exclude-Temporary-Extraneous-Same-Day</td>
<td>-</td>
</tr>
<tr class="even">
<td>7d</td>
<td>-</td>
<td>Swapped-Measurement</td>
<td>-</td>
</tr>
<tr class="odd">
<td>8f</td>
<td>-</td>
<td>Unit-Error-High</td>
<td>-</td>
</tr>
<tr class="even">
<td>8f</td>
<td>-</td>
<td>Unit-Error-Low</td>
<td>-</td>
</tr>
<tr class="odd">
<td>8f</td>
<td>-</td>
<td>Unit-Error-Possible</td>
<td>Not set in R code</td>
</tr>
<tr class="even">
<td>9c</td>
<td>3</td>
<td>Exclude-Carried-Forward</td>
<td>-</td>
</tr>
<tr class="odd">
<td>10c</td>
<td>4</td>
<td>Exclude-SD-Cutoff</td>
<td>10d, 10e</td>
</tr>
<tr class="even">
<td>11d</td>
<td>5</td>
<td>Exclude-EWMA-Extreme</td>
<td>11e</td>
</tr>
<tr class="odd">
<td>11f.ii</td>
<td>6</td>
<td>Exclude-EWMA-Extreme-Pair</td>
<td>11i (R only)</td>
</tr>
<tr class="even">
<td>12d.i</td>
<td>7</td>
<td>Exclude-Extraneous-Same-Day</td>
<td>12diii, 12ei, 12f</td>
</tr>
<tr class="odd">
<td>14f.i</td>
<td>8</td>
<td>Exclude-EWMA-8</td>
<td>Set in 14h (in R)</td>
</tr>
<tr class="even">
<td>14f.ii</td>
<td>9</td>
<td>Exclude-EWMA-9</td>
<td>Set in 14h (in R)</td>
</tr>
<tr class="odd">
<td>14f.iii</td>
<td>10</td>
<td>Exclude-EWMA-10</td>
<td>Set in 14h (in R)</td>
</tr>
<tr class="even">
<td>14f.iv</td>
<td>11</td>
<td>Exclude-EWMA-11</td>
<td>Set in 14h (in R)</td>
</tr>
<tr class="odd">
<td>14f.v</td>
<td>12</td>
<td>Exclude-EWMA-12</td>
<td>Set in 14h (in R)</td>
</tr>
<tr class="even">
<td>14f.vi</td>
<td>13</td>
<td>Exclude-EWMA-13</td>
<td>Set in 14h (in R)</td>
</tr>
<tr class="odd">
<td>14f.vii</td>
<td>14</td>
<td>Exclude-EWMA-14</td>
<td>Set in 14h (in R)</td>
</tr>
<tr class="even">
<td>15s</td>
<td>15</td>
<td>Exclude-Min-Height-Change</td>
<td>Set in 15q (in R), 15s, 15t</td>
</tr>
<tr class="odd">
<td>15s</td>
<td>16</td>
<td>Exclude-Max-Height-Change</td>
<td>Set in 15q (in R), 15s, 15t</td>
</tr>
<tr class="even">
<td>16b</td>
<td>17</td>
<td>Exclude-Pair-Delta-17</td>
<td>-</td>
</tr>
<tr class="odd">
<td>16b</td>
<td>18</td>
<td>Exclude-Pair-Delta-18</td>
<td>-</td>
</tr>
<tr class="even">
<td>-</td>
<td>-</td>
<td>Exclude-Pair-Delta-19</td>
<td>Added <code>flag.both</code> mode</td>
</tr>
<tr class="odd">
<td>16d</td>
<td>19</td>
<td>Exclude-Single-Outlier</td>
<td>-</td>
</tr>
<tr class="even">
<td>17a</td>
<td>20</td>
<td>Exclude-Too-Many-Errors</td>
<td>-</td>
</tr>
<tr class="odd">
<td>17a</td>
<td>21</td>
<td>Exclude-Too-Many-Errors-Other_Parameter</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>A researcher wanting to compare two datasets – for example, one including only measurements <code>growthcleanr</code> flags for inclusion, and a second which also includes carried forward values – could extract only measurements where the flag is set to “<code>Include</code>” for the first set and either “<code>Include</code>” or “<code>Exclude-Carried-Forward</code>” for the second set. This flexibility gives each researcher control over how to incorporate growthcleanr results into their own research.</p>
<p>For the adult algorithm, the following exclusions apply. Note that a few types are described with the same exclusion codes.</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="16%">
<col width="24%">
<col width="47%">
</colgroup>
<thead><tr class="header">
<th>algorithm step</th>
<th>implementation step</th>
<th>exclusion type</th>
<th>notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1h</td>
<td>H BIV</td>
<td>Exclude-BIV</td>
<td>-</td>
</tr>
<tr class="even">
<td>3h</td>
<td>H temp extraneous</td>
<td>-</td>
<td>Nothing excluded in this step</td>
</tr>
<tr class="odd">
<td>5h</td>
<td>H 100 metric</td>
<td>Exclude-Hundreds</td>
<td>-</td>
</tr>
<tr class="even">
<td>6h</td>
<td>H unit errors</td>
<td>Exclude-Unit-Errors</td>
<td>-</td>
</tr>
<tr class="odd">
<td>7h</td>
<td>H transpositions</td>
<td>Exclude-Transpositions</td>
<td>-</td>
</tr>
<tr class="even">
<td>8</td>
<td>swaps</td>
<td>Exclude-Swaps</td>
<td>-</td>
</tr>
<tr class="odd">
<td>9h</td>
<td>H same day extraneous</td>
<td>Exclude-Same-Day-Extraneous</td>
<td>Multiple error codes depending on outcome</td>
</tr>
<tr class="even">
<td>9h</td>
<td>H same day extraneous</td>
<td>Exclude-Same-Day-Identical</td>
<td>Multiple error codes depending on outcome</td>
</tr>
<tr class="odd">
<td>10ha</td>
<td>H distinct pairs</td>
<td>Exclude-Distinct-Pairs</td>
<td>-</td>
</tr>
<tr class="even">
<td>10hb</td>
<td>H distinct 3+</td>
<td>Exclude-Distinct-3-Or-More</td>
<td>-</td>
</tr>
<tr class="odd">
<td>11h</td>
<td>H mean heights</td>
<td>-</td>
<td>Nothing excluded in this step</td>
</tr>
<tr class="even">
<td>13</td>
<td>distinct 1</td>
<td>Exclude-Distinct-Single</td>
<td>-</td>
</tr>
<tr class="odd">
<td>14h</td>
<td>H error load</td>
<td>Exclude-Error-Load</td>
<td>-</td>
</tr>
<tr class="even">
<td>1w</td>
<td>W BIV</td>
<td>Exclude-BIV</td>
<td>-</td>
</tr>
<tr class="odd">
<td>2w</td>
<td>W repeated values</td>
<td>-</td>
<td>Nothing excluded in this step</td>
</tr>
<tr class="even">
<td>3w</td>
<td>W temp extraneous</td>
<td>-</td>
<td>Nothing excluded in this step</td>
</tr>
<tr class="odd">
<td>4w</td>
<td>W weight cap</td>
<td>Exclude-Weight-Cap</td>
<td>Since “400” will be specified by user</td>
</tr>
<tr class="even">
<td>4w</td>
<td>W weight cap</td>
<td>Exclude-Weight-Cap-Identical</td>
<td>Since “400” will be specified by user</td>
</tr>
<tr class="odd">
<td>5w</td>
<td>W hundreds</td>
<td>Exclude-Hundreds</td>
<td>-</td>
</tr>
<tr class="even">
<td>6w</td>
<td>W unit errors</td>
<td>Exclude-Unit-Errors</td>
<td>-</td>
</tr>
<tr class="odd">
<td>7w</td>
<td>W transpositions</td>
<td>Exclude-Transpositions</td>
<td>-</td>
</tr>
<tr class="even">
<td>9w</td>
<td>W extreme EWMA</td>
<td>Exclude-Extreme-EWMA</td>
<td>-</td>
</tr>
<tr class="odd">
<td>10w</td>
<td>W same day extraneous</td>
<td>Exclude-Same-Day-Extraneous</td>
<td>Multiple error codes depending on outcome</td>
</tr>
<tr class="even">
<td>10w</td>
<td>W same day extraneous</td>
<td>Exclude-Same-Day-Identical</td>
<td>Multiple error codes depending on outcome</td>
</tr>
<tr class="odd">
<td>11wa</td>
<td>W distinct ordered pairs</td>
<td>Exclude-Distinct-Ordered-Pairs</td>
<td>-</td>
</tr>
<tr class="even">
<td>11wb</td>
<td>W moderate EWMA</td>
<td>Exclude-Moderate-EWMA</td>
<td>-</td>
</tr>
<tr class="odd">
<td>12w</td>
<td>W weight cap influence</td>
<td>Exclude-Possibly-Impacted-By-Weight-Cap</td>
<td>-</td>
</tr>
<tr class="even">
<td>14w</td>
<td>W error load</td>
<td>Exclude-Error-Load</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Most weight steps</td>
<td>W repeated value exclusion</td>
<td>paste(proposed, -RV)</td>
<td>When a first repeated value is excluded, all other repeated values are excluded</td>
</tr>
</tbody>
</table>
</div>
<div id="-working-with-large-data-sets" class="section level2">
<h2 class="hasAnchor">
<a href="#-working-with-large-data-sets" class="anchor"></a><a name="largedata"></a> Working with large data sets</h2>
<p>The nature of the <code>growthcleanr</code> algorithm is repetitive. It runs many checks over each individual subject’s measurements, in a specific sequence, and revises its assessments as it goes. Because of this, it can take some time to process even a modest dataset. For reference, the <code>syngrowth</code> synthetic data example packaged with <code>growthcleanr</code> takes 2-3 minutes to process on a contemporary laptop. <code>growthcleanr</code> uses optimized libraries (e.g. <code>data.table</code>) to go as fast as possible, but there are limits given the repeated passes over data required.</p>
<p>If you have under one million records, using <code>growthcleanr</code> may just necessitate planning to wait a little while the job processes. There are several strategies to improve performance you might consider:</p>
<ul>
<li>The built-in <code>parallel</code> option should take advantage of multiple CPU cores when your hardware allows.</li>
<li>Running <code>growthcleanr</code> on a machine with more CPU cores and more RAM can improve this further.</li>
<li>Verify that supporting libraries like <code>data.table</code> are <a href="#platform">installed properly</a> for your machine</li>
<li>Anecdotally, Windows users have sometimes seen slower performance when compared with similarly-appointed hardware running Linux or macOS.</li>
</ul>
<p>For very large datasets, on the order of millions of records or more, cleaning data can take several hours or more. When running this kind of job, the risk of failures due to external factors such as power outages increases. The current structure of <code>growthcleanr</code> does not checkpoint results as progress is made, so if a job has to run overnight and fails in the middle, a researcher would likely need to start over from scratch.</p>
<p>Because <code>growthcleanr</code> operates for the most part on individual subjects one at a time, however, this issue might be mitigated by splitting the input data into many small files, then running <code>growthcleanr</code> separately on each file, with results re-combined at the end. The primary benefit of this strategy would be the saving of the results of each file as it completes, allowing a researcher whose job fails overnight to resume processing on only the as yet incomplete input files. A secondary benefit might be a slight improvement of use of available RAM.</p>
<p>Adopting this approach might require some custom code, and there are few pitfalls to avoid. The following lays out a rough approach:</p>
<ul>
<li>Extract <code>sd.median</code> values for the entire dataset as a whole using the <code>sdmedian.filename</code> option. This is critical, as <code>growthcleanr</code> will generate these values itself for an input dataset if they are not provided. If a large dataset is split into 1,000 smaller files to be cleaned separately, each of those 1,000 <code>growthcleanr</code> jobs needs to use the same <code>sd.median</code> values to recenter or the results will be inconsistent. Pass this data in to <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> using the parameter <code>sd.recenter</code>.</li>
<li>Split the data into many small files, but keep each individual subject’s measurements together in one file. If, for example, a subject has 12 measurements, all 12 should be in one and only one of the smaller files to maximize the longitudinal analysis of their values. The <code><a href="reference/splitinput.html">splitinput()</a></code> function will perform this split safely, e.g.:</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">count</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/splitinput.html">splitinput</a></span><span class="op">(</span><span class="va">syngrowth</span>, fname <span class="op">=</span> <span class="st">"mydata"</span>, fdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">count</span>
<span class="co">#&gt; [1] 8</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"mydata.*"</span><span class="op">)</span>
<span class="co">#&gt; [1] "mydata.00000.csv" "mydata.00001.csv" "mydata.00002.csv" "mydata.00003.csv"</span>
<span class="co">#&gt; [5] "mydata.00004.csv" "mydata.00005.csv" "mydata.00006.csv" "mydata.00007.csv"</span>
<span class="co">#&gt; [9] "mydata.00008.csv"</span></code></pre></div>
<ul>
<li>Use the standalone driver script <code>exec/gcdriver.R</code> to execute growthcleanr` on each separate file, then write out its results when complete. An example is below.</li>
<li>Invoke the job using a tool like <a href="https://www.gnu.org/software/parallel/">GNU Parallel</a>, which can be run on all major platforms. An example invocation is below as well.</li>
<li>If a failure occurs, set aside both the completed inputs and their results. Then re-run the job on only the remaining input data.</li>
<li>When complete, re-combine the data into one file or as otherwise appropriate.</li>
</ul>
<p>To invoke <code>gcdriver.R</code> on a single input file using <code>Rscript</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">%</span> Rscript gcdriver.R <span class="at">--quietly</span> <span class="at">--sdrecenter</span> sdmedians.csv mydata.csv mydata-cleaned.csv</span></code></pre></div>
<p>If you have many small files saved, for example, as <code>mydata.00001.csv</code>, <code>mydata.00002.csv</code>, etc., this driver can be invoked using <code>parallel</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">%</span> ls mydata.<span class="pp">?????</span>.csv <span class="kw">|</span> <span class="ex">parallel</span> <span class="at">-j2</span> <span class="at">--eta</span> <span class="dt">\</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Rscript gcdriver.R --quietly --sdrecenter sdmedians.csv {} {}-clean"</span></span></code></pre></div>
<p>This lists your input files, and passes the filename list to parallel to use in invoking the driver script, one file at a time, and to process as parallel jobs as resources are available. Each run of the job then saves the cleaned output with <code>-clean</code> appended to the input filename, and as each completes, the next file on the list will be started until all are complete. A few things to note:</p>
<ul>
<li>The careful use of naming and wildcards when listing input files and naming output files can save accidental re-running of data from output files</li>
<li>The <code>-j2</code> option specifies running two jobs at once; <code>-j0</code> would use as many CPU cores as a machine has available. This might need to vary to match specific hardware.</li>
<li>The <code>--eta</code> option will report on progress.</li>
<li>The <code>--quietly</code> option on the driver script will make it easier to monitor progress with less verbose output coming from <code>growthcleanr</code>.</li>
<li>The <code>--sdrecenter</code> option on the driver script should be set to ensure each individual file is recentered using the same set for the entire input.</li>
<li>If multiple cores are available, the job should proceed with speedup roughly similar to what can be gained using the parallel batching feature built in to <code>growthcleanr</code>, with the main difference being the saving of intermediate output as each smaller file completes.</li>
</ul>
<p>If your data to be cleaned is very large, it might help to store it compressed, for example with <code>gzip</code> and its corresponding <code>.gz</code> filename extension. <code>growthcleanr</code> can read in <code>.gz</code> input, but you might need to install the <code>R.utils</code> package first. <code>R</code> will provide a message if this is required.</p>
</div>
<div id="computing-pediatric-bmi-percentiles-and-z-scores" class="section level2">
<h2 class="hasAnchor">
<a href="#computing-pediatric-bmi-percentiles-and-z-scores" class="anchor"></a><a name="bmi"></a>Computing pediatric BMI percentiles and Z-scores</h2>
<p>The CDC provides a <a href="https://www.cdc.gov/nccdphp/dnpao/growthcharts/resources/sas.htm">SAS macro for computing BMI percentiles and Z-scores</a>; the function <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code>, included in <code>growthcleanr</code>, provides an equivalent feature. <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code> calculates the sigma (scale parameter for the half-normal distribution, extended BMI percentile), extended BMIz, and the CDC LMS z-scores for weight, height, and BMI. Note that for BMIs ≤ 95th percentile of the CDC growth charts, the extended values for BMI are equal to the LMS values. The extended values differ only for children who have a BMI &gt; 95th percentile.</p>
<p>The function assumes a variable ‘sex’ (coded as 1=boys / 2=girls) and variables for age in months, weight (kg), height (cm), and BMI (weight/ht2). Please be careful with age - the units should be months and use the most accurate information available (e.g., 23.4928 months. The extended BMIz is the inverse cumulative distribution function (CDF) of the extended BMI percentile. If the extended percentile is very close to 100, the <code>qnorm</code> function in R produces an infinite value. The occurs only if the extended BMI percentile is &gt; 99.99999999999999. This occurs infrequently, such as a 48-month-old with a BMI &gt; 39, and it is likely that these BMIs represent data entry errors. For these cases, extended BMIz is set to 8.21, a value that is slightly greater than the largest value that can be calculated.</p>
<p>Because <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code> performs cross-sectional analysis of BMI, observation data must be in a wide format, i.e. with height and weight information on the same row. This is distinct from <code><a href="reference/cleangrowth.html">cleangrowth()</a></code>, which performs longitudinal analysis on all observations for each subject, presented in a long format with one observation per row. To facilitate use of both functions, <code>growthcleanr</code> includes utility functions to transform data used with <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> for use with <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code>. They are optimized to move data directly from the output of <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> into input for <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code>, but have options to support independent use as well.</p>
<p>Using the <code>syngrowth</code> example dataset, to convert the data after it has been cleaned by <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> for use with <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code>, use <code><a href="reference/longwide.html">longwide()</a></code> and <code><a href="reference/simple_bmi.html">simple_bmi()</a></code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use the built-in utility function to convert the input observations to wide</span>
<span class="co"># format for BMI calculation</span>
<span class="va">cleaned_data_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/longwide.html">longwide</a></span><span class="op">(</span><span class="va">cleaned_data</span><span class="op">)</span>

<span class="co"># Compute simple BMI values (adds column "bmi")</span>
<span class="va">cleaned_data_bmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simple_bmi.html">simple_bmi</a></span><span class="op">(</span><span class="va">cleaned_data_wide</span><span class="op">)</span>

<span class="co"># Compute Z-scores and percentiles</span>
<span class="va">cleaned_data_bmiz</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ext_bmiz.html">ext_bmiz</a></span><span class="op">(</span><span class="va">cleaned_data_bmi</span><span class="op">)</span></code></pre></div>
<p>Note that this assumes that <code>cleaned_data</code> has the same structure as before:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cleaned_data)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"id"</span>          <span class="st">"subjid"</span>      <span class="st">"sex"</span>         <span class="st">"agedays"</span>     <span class="st">"param"</span>       <span class="st">"measurement"</span> <span class="st">"gcr_result"</span></span></code></pre></div>
<p>The wide dataset <code>cleaned_data_wide</code> will include rows with aligned height and weight measurements drawn from the observations in <code>cleaned_data</code> marked by <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> for inclusion. As such, it will be a shorter dataset (fewer rows) based on fewer observations.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(cleaned_data)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">85728</span>     <span class="dv">7</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(cleaned_data_wide)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">26701</span>     <span class="dv">9</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cleaned_data_wide)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                                subjid    agey     agem sex   wt wt_id    ht ht_id  agedays</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28 <span class="fl">56.0964</span> <span class="fl">673.1568</span>   <span class="dv">2</span> <span class="fl">71.7</span> <span class="dv">83331</span> <span class="fl">151.1</span> <span class="dv">83330</span> <span class="fl">20489.22</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28 <span class="fl">57.1122</span> <span class="fl">685.3464</span>   <span class="dv">2</span> <span class="fl">73.2</span> <span class="dv">83333</span> <span class="fl">151.1</span> <span class="dv">83332</span> <span class="fl">20860.22</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28 <span class="fl">58.1279</span> <span class="fl">697.5348</span>   <span class="dv">2</span> <span class="fl">74.6</span> <span class="dv">83336</span> <span class="fl">151.1</span> <span class="dv">83335</span> <span class="fl">21231.22</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28 <span class="fl">59.1437</span> <span class="fl">709.7244</span>   <span class="dv">2</span> <span class="fl">72.8</span> <span class="dv">83338</span> <span class="fl">151.1</span> <span class="dv">83337</span> <span class="fl">21602.22</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28 <span class="fl">59.2012</span> <span class="fl">710.4144</span>   <span class="dv">2</span> <span class="fl">72.4</span> <span class="dv">83340</span> <span class="fl">151.1</span> <span class="dv">83339</span> <span class="fl">21623.22</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> 002986c5<span class="sc">-</span>354d<span class="sc">-</span>bb9d<span class="sc">-</span>c180<span class="sc">-</span>4ce26813ca28 <span class="fl">60.1594</span> <span class="fl">721.9128</span>   <span class="dv">2</span> <span class="fl">69.4</span> <span class="dv">83343</span> <span class="fl">151.1</span> <span class="dv">83342</span> <span class="fl">21973.22</span></span></code></pre></div>
<p>In this example, the subject identifiers previously marked as <code>subjid</code> are now in the <code>id</code> column; individual identifiers for observations of a single parameter are not present.</p>
<p><code><a href="reference/longwide.html">longwide()</a></code> can be called with name mapping parameters if your input set uses different column names. For example, if <code>my_cleaned_data</code> specifies age in days as <code>aged</code> and parameter type as <code>type</code>, specify each, with quotes:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(my_cleaned_data)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>     id subjid sex    aged     type measurement                  gcr_result</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="dv">1510</span> <span class="dv">775155</span>   <span class="dv">0</span>     <span class="dv">889</span> HEIGHTCM       <span class="fl">84.90</span> Exclude<span class="sc">-</span>Extraneous<span class="sc">-</span>Same<span class="sc">-</span>Day</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="dv">1511</span> <span class="dv">775155</span>   <span class="dv">0</span>     <span class="dv">889</span> HEIGHTCM       <span class="fl">89.06</span>                     Include</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="dv">1518</span> <span class="dv">775155</span>   <span class="dv">0</span>     <span class="dv">889</span> WEIGHTKG       <span class="fl">13.10</span>                     Include</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="dv">1512</span> <span class="dv">775155</span>   <span class="dv">0</span>    <span class="dv">1071</span> HEIGHTCM       <span class="fl">92.50</span>                     Include</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> <span class="dv">1519</span> <span class="dv">775155</span>   <span class="dv">0</span>    <span class="dv">1071</span> WEIGHTKG       <span class="fl">14.70</span>                     Include</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="dv">1513</span> <span class="dv">775155</span>   <span class="dv">0</span>    <span class="dv">1253</span> HEIGHTCM       <span class="fl">96.20</span>                     Include</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">longwide</span>(my_cleaned_data, <span class="at">agedays =</span> <span class="st">"aged"</span>, <span class="at">param =</span> <span class="st">"type"</span>)</span></code></pre></div>
<p>By default, <code><a href="reference/longwide.html">longwide()</a></code> will only transform records flagged by <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> for inclusion. To include more records, specify each category assigned by <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> using the <code>inclusion_types</code> option. For example, to include carried forward values along with included records for the BMI calculation:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cleaned_data_wide_cf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/longwide.html">longwide</a></span><span class="op">(</span>
  long_df <span class="op">=</span> <span class="va">cleaned_data</span>,
  inclusion_types<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Include"</span>, <span class="st">"Exclude-Carried-Forward"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>An additional option, <code>include_all</code>, set to <code>FALSE</code> by default, will include all observations for transformation.</p>
<p>See <code><a href="reference/longwide.html">?longwide</a></code> for full details.</p>
<p>With wide data in hand, output taken directly from <code><a href="reference/longwide.html">longwide()</a></code> can be passed to <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code>. Alternatively, you can provide a similarly formatted data frame directly to <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code>.</p>
<p>Note that <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code> expects the <code>sex</code> variable to be coded as a numeric value of <code>1</code> (male) or <code>2</code> (female). <code><a href="reference/longwide.html">longwide()</a></code> will handle this given the expected input values of <code>0</code> (male) or <code>1</code> (female).</p>
<p>If you are using different input data for <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code>, ensure the <code>sex</code> variable in your data set is properly coded. To do so, use <code><a href="reference/recode_sex.html">recode_sex()</a></code>. For example, if you have data in the PCORnet CDM format:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/recode_sex.html">recode_sex</a></span><span class="op">(</span>
  input_data <span class="op">=</span> <span class="va">cdm_formatted</span>,
  sourcecol <span class="op">=</span> <span class="st">"sex"</span>,
  sourcem <span class="op">=</span> <span class="st">"M"</span>,
  sourcef <span class="op">=</span> <span class="st">"F"</span>,
  targetm <span class="op">=</span> <span class="fl">1L</span>,
  targetf <span class="op">=</span> <span class="fl">2L</span>
<span class="op">)</span></code></pre></div>
<p>With data in wide format and with sex variables properly coded, <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code> can be called:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cleaned_data_bmi <span class="ot">&lt;-</span> <span class="fu">ext_bmiz</span>(cleaned_data_wide)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cleaned_data_bmi)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>           id    agey     agem      bmi sex   wt     ht agedays      age     bmi_l    bmi_m      bmi_s         waz    mod_waz        haz    mod_haz     bmiz  mod_bmiz</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="dv">1000287994</span> <span class="fl">10.0301</span> <span class="fl">120.3612</span> <span class="fl">22.84087</span>   <span class="dv">1</span> <span class="fl">40.1</span> <span class="fl">132.50</span>    <span class="dv">3661</span> <span class="fl">120.3612</span> <span class="sc">-</span><span class="fl">2.767881</span> <span class="fl">16.64016</span> <span class="fl">0.12002409</span>  <span class="fl">1.09852664</span>  <span class="fl">0.8417277</span> <span class="sc">-</span><span class="fl">0.9597118</span> <span class="sc">-</span><span class="fl">0.9717678</span> <span class="fl">1.757419</span> <span class="fl">1.5409867</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="dv">1000287994</span> <span class="fl">11.0466</span> <span class="fl">132.5592</span> <span class="fl">22.84087</span>   <span class="dv">1</span> <span class="fl">40.1</span> <span class="fl">132.50</span>    <span class="dv">4032</span> <span class="fl">132.5592</span> <span class="sc">-</span><span class="fl">2.589785</span> <span class="fl">17.20379</span> <span class="fl">0.12676206</span>  <span class="fl">0.52509455</span>  <span class="fl">0.3595874</span> <span class="sc">-</span><span class="fl">1.6331550</span> <span class="sc">-</span><span class="fl">1.6408514</span> <span class="fl">1.584028</span> <span class="fl">1.2827508</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="dv">1000287994</span> <span class="fl">12.0630</span> <span class="fl">144.7560</span> <span class="fl">18.35674</span>   <span class="dv">1</span> <span class="fl">40.1</span> <span class="fl">147.80</span>    <span class="dv">4403</span> <span class="fl">144.7560</span> <span class="sc">-</span><span class="fl">2.444694</span> <span class="fl">17.82828</span> <span class="fl">0.13146572</span> <span class="sc">-</span><span class="fl">0.08603109</span> <span class="sc">-</span><span class="fl">0.1155501</span> <span class="sc">-</span><span class="fl">0.2209003</span> <span class="sc">-</span><span class="fl">0.2267003</span> <span class="fl">0.214444</span> <span class="fl">0.1132188</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="dv">1000287994</span> <span class="fl">13.0795</span> <span class="fl">156.9540</span> <span class="fl">24.12048</span>   <span class="dv">1</span> <span class="fl">57.8</span> <span class="fl">154.80</span>    <span class="dv">4774</span> <span class="fl">156.9540</span> <span class="sc">-</span><span class="fl">2.325379</span> <span class="fl">18.49734</span> <span class="fl">0.13420981</span>  <span class="fl">1.07298540</span>  <span class="fl">0.8792766</span> <span class="sc">-</span><span class="fl">0.2418916</span> <span class="sc">-</span><span class="fl">0.2436118</span> <span class="fl">1.475755</span> <span class="fl">1.1619424</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> <span class="dv">1000287994</span> <span class="fl">14.0959</span> <span class="fl">169.1508</span> <span class="fl">25.03608</span>   <span class="dv">1</span> <span class="fl">66.6</span> <span class="fl">163.10</span>    <span class="dv">5145</span> <span class="fl">169.1508</span> <span class="sc">-</span><span class="fl">2.222102</span> <span class="fl">19.19533</span> <span class="fl">0.13527053</span>  <span class="fl">1.24466369</span>  <span class="fl">1.0724802</span> <span class="sc">-</span><span class="fl">0.1772860</span> <span class="sc">-</span><span class="fl">0.1713432</span> <span class="fl">1.483245</span> <span class="fl">1.1877586</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="dv">1000287994</span>  <span class="fl">4.9479</span>  <span class="fl">59.3748</span> <span class="fl">16.88341</span>   <span class="dv">1</span> <span class="fl">19.5</span> <span class="fl">107.47</span>    <span class="dv">1806</span>  <span class="fl">59.3748</span> <span class="sc">-</span><span class="fl">2.533423</span> <span class="fl">15.43155</span> <span class="fl">0.07546578</span>  <span class="fl">0.48691152</span>  <span class="fl">0.3858433</span> <span class="sc">-</span><span class="fl">0.2363398</span> <span class="sc">-</span><span class="fl">0.2340109</span> <span class="fl">1.065532</span> <span class="fl">0.8981828</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>       bmip      p95      p97    bmip95       wp       hp obese sev_obese ext_bmiz ext_bmip    sigma</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="fl">96.05768</span> <span class="fl">22.14172</span> <span class="fl">23.71268</span> <span class="fl">103.15762</span> <span class="fl">86.40127</span> <span class="fl">16.86001</span>     <span class="dv">1</span>         <span class="dv">0</span> <span class="fl">1.705525</span> <span class="fl">95.59517</span> <span class="fl">4.668954</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="fl">94.34063</span> <span class="fl">23.21872</span> <span class="fl">24.93200</span>  <span class="fl">98.37264</span> <span class="fl">70.02413</span>  <span class="fl">5.12182</span>     <span class="dv">0</span>         <span class="dv">0</span> <span class="fl">1.584028</span> <span class="fl">94.34063</span> <span class="fl">5.002164</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="fl">58.48996</span> <span class="fl">24.25081</span> <span class="fl">26.05464</span>  <span class="fl">75.69536</span> <span class="fl">46.57209</span> <span class="fl">41.25850</span>     <span class="dv">0</span>         <span class="dv">0</span> <span class="fl">0.214444</span> <span class="fl">58.48996</span> <span class="fl">5.316539</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="fl">92.99952</span> <span class="fl">25.21239</span> <span class="fl">27.05537</span>  <span class="fl">95.66916</span> <span class="fl">85.83612</span> <span class="fl">40.44321</span>     <span class="dv">0</span>         <span class="dv">0</span> <span class="fl">1.475755</span> <span class="fl">92.99952</span> <span class="fl">5.612141</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> <span class="fl">93.09953</span> <span class="fl">26.09135</span> <span class="fl">27.92776</span>  <span class="fl">95.95547</span> <span class="fl">89.33723</span> <span class="fl">42.96419</span>     <span class="dv">0</span>         <span class="dv">0</span> <span class="fl">1.483245</span> <span class="fl">93.09953</span> <span class="fl">5.888911</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="fl">85.66823</span> <span class="fl">17.91161</span> <span class="fl">18.39937</span>  <span class="fl">94.25957</span> <span class="fl">68.68395</span> <span class="fl">40.65845</span>     <span class="dv">0</span>         <span class="dv">0</span> <span class="fl">1.065532</span> <span class="fl">85.66823</span> <span class="fl">2.720945</span></span></code></pre></div>
<p>The output columns include:</p>
<table class="table">
<colgroup>
<col width="14%">
<col width="85%">
</colgroup>
<thead><tr class="header">
<th>variable</th>
<th>description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>waz, wp</td>
<td>LMS Weight-for-sex/age z-score and percentile</td>
</tr>
<tr class="even">
<td>haz, hp</td>
<td>LMS Height-for-sex/age z-score and percentile</td>
</tr>
<tr class="odd">
<td>bmiz, bmip</td>
<td>LMS BMI-for-sex/age z-score and percentile</td>
</tr>
<tr class="even">
<td>mod_waz, mod_haz, mod_bmi</td>
<td>Modified z-scores for identifying outliers (see the information in the <a href="https://www.cdc.gov/nccdphp/dnpao/growthcharts/resources/sas.htm">CDC SAS growth charts program website</a>)</td>
</tr>
<tr class="odd">
<td>bmip95</td>
<td>BMI expressed as a percentage of the 95th percentile. A value ≥ 120 is widely used as the cut point for severe obesity.</td>
</tr>
<tr class="even">
<td>sigma</td>
<td>Scale parameter of the half-normal distribution</td>
</tr>
<tr class="odd">
<td>ext_bmip</td>
<td>Extended BMI percentile</td>
</tr>
<tr class="even">
<td>ext_bmiz</td>
<td>Extended BMI z-score</td>
</tr>
</tbody>
</table>
<p>For convenience, these labels are available on the output of <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code>, e.g., when viewed in RStudio with <code><a href="https://rdrr.io/r/utils/View.html">View(cleaned_data_bmi)</a></code>, or on the console:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span><span class="op">(</span><span class="va">cleaned_data_bmi</span><span class="op">)</span></code></pre></div>
<p>Like <code><a href="reference/longwide.html">longwide()</a></code>, <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code> also includes options for mapping alternate column names, for age, weight, height, and BMI. The default column names are the same as the output from <code><a href="reference/longwide.html">longwide()</a></code> for convenience. If you have different column names, specify the column names without quotes. For example, for a dataset using “heightcm” and “weightkg” instead of “ht” and “wt”:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_cleaned_data_bmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ext_bmiz.html">ext_bmiz</a></span><span class="op">(</span><span class="va">my_cleaned_data_wide</span>, ht <span class="op">=</span> <span class="va">heightcm</span>, wt <span class="op">=</span> <span class="va">weightkg</span><span class="op">)</span></code></pre></div>
<p>For <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code>, use the most precise age in months available. If an input dataset only has age in months as integer values, by default <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code> will automatically convert these to double values and add <code>0.5</code> to account for the distribution of actual ages over the range of days within a month. This is enabled with the option <code>adjust.integer.age</code>, set to <code>TRUE</code> by default. Specify <code>FALSE</code> to disable.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_cleaned_data_bmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ext_bmiz.html">ext_bmiz</a></span><span class="op">(</span><span class="va">my_cleaned_data_wide</span>, adjust.integer.age <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code> uses reference data provided by the CDC, included in the <code>growthcleanr</code> package as <code>inst/extdata/CDCref_d.csv</code>. This file is automatically loaded and used by default. If you are working with a different reference dataset or developing the <code>growthcleanr</code> package, specify an alternate path to this file with <code>ref.data.path</code>, as for <code><a href="reference/cleangrowth.html">cleangrowth()</a></code>.</p>
</div>
<div id="related-tools" class="section level2">
<h2 class="hasAnchor">
<a href="#related-tools" class="anchor"></a><a name="related"></a>Related tools</h2>
<p>The CDC provides a <a href="https://www.cdc.gov/nccdphp/dnpao/growthcharts/resources/sas.htm">SAS Program for the 2000 CDC Growth Charts</a> which can also be used to identify biologically implausible values using a different approach, as also implemented for <code>growthcleanr</code> in the function <code><a href="reference/ext_bmiz.html">ext_bmiz()</a></code>, described above under <a href="#bmi">Computing BMI percentiles and Z-scores</a>.</p>
<p><a href="https://github.com/mitre/GrowthViz">GrowthViz</a> provides insights into how <code>growthcleanr</code> assesses data, packaged in a Jupyter notebook. It ships with the same <code>syngrowth</code> synthetic example dataset as <code>growthcleanr</code>, with results included.</p>
</div>
<div id="nhanes-reference-medians" class="section level2">
<h2 class="hasAnchor">
<a href="#nhanes-reference-medians" class="anchor"></a><a name="nhanes"></a>NHANES reference medians</h2>
<p><code>growthcleanr</code> <a href="https://github.com/carriedaymont/growthcleanr/releases">releases</a> up to 1.2.4 offered two options for recentering medians, either the default of deriving medians from the input set, or supplying an externally-defined set of medians. These left out an option for researchers working with either small datasets or with data which might otherwise not be representative of the population, as deriving medians from the input set in those cases might be problematic. To provide a standard default reference to address these latter cases, a set of medians were derived from the <a href="https://wwwn.cdc.gov/nchs/nhanes/Default.aspx">National Health and Nutrition Examination Survey</a> (NHANES). A summary of that process is below. As of release 1.2.5, the default behavior is:</p>
<ul>
<li>If <code>sd.recenter</code> is specified as a data set, use the data set</li>
<li>If <code>sd.recenter</code> is specified as <code>nhanes</code>, use NHANES</li>
<li>If <code>sd.recenter</code> is specified as <code>derive</code>, derive from input</li>
<li>If <code>sd.recenter</code> is not specified or <code>NA</code>:
<ul>
<li>If the input set has at least 5,000 observations, derive medians from input</li>
<li>If the input set has fewer than 5,000 observations, use NHANES</li>
</ul>
</li>
</ul>
<p>With the verbose <code><a href="reference/cleangrowth.html">cleangrowth()</a></code> option <code>quietly = FALSE</code>, the recentering medians approach used will be noted in the output. If the input set has fewer than 100 observations for any age-year, this will also be noted in the output.</p>
<p>The NHANES reference medians are based primarily on data from NHANES 2009-2010 through 2017-2018, including approximately 39,000 heights/lengths and weights from children and adolescents between the ages of 0 months and &lt;240 months. Weight and height SD scores were calculated from the <a href="https://www.cdc.gov/growthcharts/percentile_data_files.htm">L, M, and S parameters</a> for the <a href="https://www.cdc.gov/nccdphp/dnpao/growthcharts/resources/sas.htm">CDC growth charts</a> were used as the reference to calculate weight and height SD scores for the NHANES 2009-2010 through 2017-2018 samples. Based on the distributions of age-days in children at 0 months, an age adjustment was made based on the median number of days among these infants. This adjustment was made after consultation with the National Center for Health Statistics confirmed that a general assumption of ages occurring at the midpoint of the indicated integer month of age did not apply to children recorded as 0 months, and uses 0.75 months instead.</p>
<p>Weights were supplemented with a random sample of birthweights from NCHS’s <a href="https://www.nber.org/research/data/vital-statistics-natality-birth-data">Vital Statistics Natality Birth Data</a> for 2018. These had sample weights assigned so that the sum of the sample weights for the sample equalled the sum of the sample weights for each month for infants in NHANES, as NHANES is a multi-stage complex survey. The reference data was then smoothed using the <code>svysmooth()</code> function in the R <a href="https://cran.r-project.org/web/packages/survey/index.html"><code>survey</code></a> package to estimate the weight and height SD scores for each day up to 7,305 days, with a bandwidth chosen to balance between over- and under-fitting, and interpolation between the estimates from this function was used to obtain an estimate for each day of age. Predictions from a regression model fit to smoothed height SDs between 23 and 365 days (the youngest child in NHANES had an estimated age in days of 23) were used to extend smoothed height SD scores to children between 1 and 22 days of age.</p>
</div>
<div id="changes" class="section level2">
<h2 class="hasAnchor">
<a href="#changes" class="anchor"></a><a name="changes"></a>Changes</h2>
<p>For a detailed history of released versions, see <code>NEWS.md</code>. Tagged releases, starting with 1.2.3 in January 2021, are listed <a href="https://github.com/carriedaymont/growthcleanr/releases">at GitHub</a>.</p>
<p>In release 1.2.5 in February 2021, the default behavior of recentering medians changed as described in <a href="#nhanes">NHANES reference medians</a>. To confirm prior results based on derived medians, specify the <code>sd.recenter</code> option “derive”.</p>
<p>In release 1.2.4 in January 2021, an update was made to the WHO height velocity 3sd files to correct a small number of errors:</p>
<ul>
<li><code>inst/extdata/who_ht_maxvel_3sd.csv</code></li>
<li><code>inst/extdata/who_ht_vel_3sd.csv</code></li>
</ul>
<p>Although these changes were very minor, it is possible that results on data cleaned after this change may vary from previous results. The prior version of these files may be obtained by visiting the tagged release version 1.2.3 at <a href="https://github.com/carriedaymont/growthcleanr/releases/tag/1.2.3" class="uri">https://github.com/carriedaymont/growthcleanr/releases/tag/1.2.3</a>.</p>
<p>The released version of <code>growthcleanr</code> available at that link contains the older version of both files; that older version may be used to verify reproducibility.</p>
<p>Alternatively, a more recent version of <code>growthcleanr</code> may be used with only the affected files replaced with their older versions available at the 1.2.3 tag link above. This must be done manually.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing growthcleanr</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Daymont Carrie <br><small class="roles"> Author, maintainer </small>  </li>
<li>Grundmeier Robert <br><small class="roles"> Author </small>  </li>
<li>Miller Jeffrey <br><small class="roles"> Author </small>  </li>
<li>Campos Diego <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/carriedaymont/growthcleanr/actions"><img src="https://github.com/carriedaymont/growthcleanr/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Daymont Carrie, Grundmeier Robert, Miller Jeffrey, Campos Diego.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
